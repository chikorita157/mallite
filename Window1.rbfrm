#tag WindowBegin Window Window1   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   400   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   True   MaxWidth        =   32000   MenuBar         =   1408782882   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   True   Title           =   "MAL Lite"   Visible         =   True   Width           =   550   Begin Timer Timer1      Height          =   32      Index           =   -2147483648      InitialParent   =   ""      Left            =   682      LockedInPosition=   False      Mode            =   2      Period          =   900000      Scope           =   0      TabPanelIndex   =   0      Top             =   254      Width           =   32   End   Begin httpsocket socket1      Address         =   ""      Height          =   32      Index           =   -2147483648      Left            =   384      LockedInPosition=   False      Port            =   0      Scope           =   0      TabPanelIndex   =   0      Top             =   -51      Width           =   32      yield           =   0   End   Begin Listbox yourlist      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   1      ColumnsResizable=   True      ColumnWidths    =   ""      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   ""      HeadingIndex    =   -1      Height          =   366      HelpTag         =   ""      Hierarchical    =   False      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   13      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   34      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   550      _ScrollWidth    =   -1   End   Begin Maintoolbar Maintoolbar1      Enabled         =   True      Height          =   32      Index           =   -2147483648      InitialParent   =   ""      Left            =   674      LockedInPosition=   False      Scope           =   0      TabPanelIndex   =   0      Top             =   20      Visible         =   True      Width           =   100   End   Begin PopupMenu filtermenu      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   25      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   "watching\rcompleted\ron-hold\rdropped\rplan to watch"      Italic          =   ""      Left            =   55      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   14      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   5      Underline       =   ""      Visible         =   True      Width           =   126   End   Begin StaticText StaticText1      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   7      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      TabIndex        =   15      TabPanelIndex   =   0      Text            =   "Filter:"      TextAlign       =   0      TextColor       =   0      TextFont        =   "System"      TextSize        =   12      TextUnit        =   0      Top             =   7      Underline       =   ""      Visible         =   True      Width           =   100   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  quit		End Sub	#tag EndEvent	#tag Event		Sub Open()		  // Create Tray Item		  app.createtray		  		  //Set Titlebar		  		  me.title = "MAL Lite - (Logged in as " + app.memusername + ")"		  		  		  //set up yourlist listbox		  yourlist.columncount=6		  yourlist.columnwidths="0,56%,10%,12%,12%,10%"		  yourlist.HasHeading=True		  yourlist.Heading(0)="ID"		  yourlist.Heading(1)="Title"		  yourlist.Heading(2)="Type"		  yourlist.Heading(3)="Episodes"		  yourlist.Heading(4)="Progress"		  yourlist.Heading(5)="Rating"		  yourlist.Column(0).UserResizable=false		  		  //Populate data to the list		  refreshlist()		  		  		End Sub	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			me.hide			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub filterlist()		  //Populate data to the list		  // clear list		  yourlist.DeleteAllRows		  dim XML as new XMLDocument		  xml.LoadXML(listdata)		  r = getXMLroot(xml)		  p = getList(r)		  c = p.Length - 1		  yourlist.visible = false		  for i = 0 to c		    d = parseAnime(p.Item(i))		    If d.Value("watched_status") = filtermenu.text then		      Yourlist.AddRow(d.Value("id"))		      Yourlist.Cell(Yourlist.LastIndex, 1) = d.Value("title")		      Yourlist.Cell(Yourlist.LastIndex, 2) = d.Value("type")		      Yourlist.Cell(Yourlist.LastIndex, 3) = d.Value("watched_episodes") + "/" + d.Value("episodes")		      Yourlist.Cell(Yourlist.LastIndex, 4) = cstr(round(val(d.Value("watched_episodes"))/val(d.value("episodes"))*100) )+ "%"		      Yourlist.Cell(Yourlist.LastIndex, 5) = d.Value("score")		    else		    end if		  next		  yourlist.visible = true		  xml = nil		  r = nil		  d = nil		  p = nil		  		  //Sort list		  Yourlist.ColumnsortDirection(1)=ListBox.sortascending		  Yourlist.SortedColumn=1//sort by Name		  Yourlist.Sort		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub refreshlist()		  // Obtain your anime list		  listdata = socket1.get("http://mal-api.com/animelist/" + prefs.stringusername + "?format=xml" ,10)		  // debugyourlist.text = data		  If listdata is nil then		    app.errboxshow("There is a problem while retreving your list",   "Unable to refresh your Anime List. Make sure you are connected to the internet!")		  else		    //Populate data to the list		    // clear list		    yourlist.DeleteAllRows		    dim XML as new XMLDocument		    XML.LoadXML(listdata)		    r = getXMLroot(xml)		    p = getList(r)		    c = p.Length - 1		    yourlist.visible = false		    for i = 0 to c		      d = parseAnime(p.Item(i))		      If d.Value("watched_status") = filtermenu.text then		        Yourlist.AddRow(d.Value("id"))		        Yourlist.Cell(Yourlist.LastIndex, 1) = d.Value("title")		        Yourlist.Cell(Yourlist.LastIndex, 2) = d.Value("type")		        Yourlist.Cell(Yourlist.LastIndex, 3) = d.Value("watched_episodes") + "/" + d.Value("episodes")		        Yourlist.Cell(Yourlist.LastIndex, 4) = cstr(round(val(d.Value("watched_episodes"))/val(d.value("episodes"))*100) )+ "%"		        Yourlist.Cell(Yourlist.LastIndex, 5) = d.Value("score")		        		      else		      end if		    next		    yourlist.visible = true		    xml = nil		    r = nil		    d = nil		    p = nil		  end if		  		  //Sort list		  Yourlist.ColumnsortDirection(1)=ListBox.sortascending		  Yourlist.SortedColumn=1 //sort by name		  Yourlist.Sort		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub yourlistlookup()		  ShowURL "http://myanimelist.net/anime.php?id=" + yourlist.cell(yourlist.listindex,0)		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		c As Integer	#tag EndProperty	#tag Property, Flags = &h0		d As dictionary	#tag EndProperty	#tag Property, Flags = &h0		i As Integer	#tag EndProperty	#tag Property, Flags = &h0		listdata As string	#tag EndProperty	#tag Property, Flags = &h0		p As XmlNodeList	#tag EndProperty	#tag Property, Flags = &h0		r As XmlNode	#tag EndProperty#tag EndWindowCode#tag Events Timer1	#tag Event		Sub Action()		  refreshlist()		End Sub	#tag EndEvent#tag EndEvents#tag Events yourlist	#tag Event		Sub Change()		  If yourlist.listindex = -1 then		    maintoolbar1.RemoveItem.enabled = false		    maintoolbar1.update.enabled = false		    maintoolbar1.melativeupdate.enabled = false		  else		    maintoolbar1.RemoveItem.enabled = true		    maintoolbar1.update.enabled = true		    maintoolbar1.melativeupdate.enabled = true		  End If		End Sub	#tag EndEvent	#tag Event		Function KeyDown(Key As String) As Boolean		  if key = chr(13) then		    yourlistlookup		  end if		End Function	#tag EndEvent	#tag Event		Sub DoubleClick()		  yourlistlookup		End Sub	#tag EndEvent#tag EndEvents#tag Events Maintoolbar1	#tag Event		Sub Action(item As ToolItem)		  Select Case Item.Name		  Case "Update"		    If yourlist.listindex = -1 then		      Msgbox "You need to select a title before you can update it"		    else		      dim w as new updatewindow		      dim aniid as string		      aniid = yourlist.cell(yourlist.listindex,0)		      w.aniid = aniid		      w.loadinfo()		      w.showModal		      if w.doIt = true then		        		        refreshlist		      end if		      w.close		    end if		  case "removeitem"		    If yourlist.listindex = -1 then		      Msgbox "You need to select a title before you can remove it"		    else		      dim aniname as string		      aniname = yourlist.cell(yourlist.listindex,1)		      Dim d as New MessageDialog //declare the MessageDialog object		      Dim b as MessageDialogButton //for handling the result		      d.icon=MessageDialog.GraphicCaution //display warning icon		      d.ActionButton.Caption="Delete"		      d.CancelButton.Visible=True    //show the Cancel button		      d.Message="Are you sure you want to delete " + aniname + " from your list?"		      d.Explanation="Once deleted, this operation cannot be undone."		      b=d.ShowModal //display the dialog		      Select Case b //determine which button was pressed.		      Case d.ActionButton		        //user pressed Delete		        //perform delete		        dim aniid as string		        aniid = yourlist.cell(yourlist.listindex,0)		        Dim form as Dictionary		        // create and populate the form object		        form = New Dictionary		        form.value("_method") = "DELETE"		        // setup the socket to POST the form		        socket1.setFormData form		        socket1.setrequestheader "Authorization","Basic " + app.loginenc		        socket1.post ("http://mal-api.com/animelist/anime/" + AniID )		        Msgbox aniname + " is removed from your list."		        		        window1.refreshlist		      Case d.CancelButton		        //user pressed Cancel		      End select		    end if		  case "refresh"		    refreshlist		  case "melativeupdate"		    If prefs.BooleanMelUpdates = true then		      dim mu as new melupdatewindow		      mu.titletext.Text = yourlist.cell(yourlist.listindex,1)		      mu.checkbox1.value = true		      mu.ShowModalWithin(self.TrueWindow)		      mu.close		    else		      app.errboxshow("MAL Lite was unable to post a melative update on this series.","You must configure your melative credentials before you can post a melative update on this series. Configure your credentials, enable melative updating and try again.")		    end if		  end select		End Sub	#tag EndEvent#tag EndEvents#tag Events filtermenu	#tag Event		Sub Change()		  filterlist		End Sub	#tag EndEvent#tag EndEvents